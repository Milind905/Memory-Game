<html>

<head>
	<link href = "css/reset.css" rel="stylesheet" type = "text/css"/>
	<link href = "css/main.css" rel="stylesheet" type = "text/css"/>
</head>

<body>
	<div id='selectLevelDiv' style="display:none;">
		<div id='tableTitle'>
			<label id='tableTitleLabel'>SELECT LEVEL</label>
		</div>
	</div>

	<div id='selectModeDiv' style="display:none;">
		<div id='modeTitle'>
			<label id='modeTitleLabel'>SELECT MODE</label>
		</div>
		<div class='modeOptions' id='modeOption1' onclick='optionSelected(1)'>
			<label class='modeOptionsLabel' id='modeOptionLabel1'>Single Mode</label>
		</div>
		<div class='modeOptions' id='modeOption2' onclick='optionSelected(2)'>
			<label class='modeOptionsLabel' id='modeOptionLabel2'>Double Mode</label>
		</div>
		<div class='modeOptions' id='modeOption3' onclick='optionSelected(3)'>
			<label class='modeOptionsLabel' id='modeOptionLabel3'>Triple Mode</label>
		</div>
	</div>

	<div id='startDiv' style="display:none;">
		<button id='startGameButton' onclick="loadMainGame()">Start Game</button>
	</div>

	<div id='gameDiv' style="display:none;">
		<div id='grid'>
		</div>

		<div id='statusText'>
			<label id='pressToStart'>Game Starting!</label>
		</div>

		<div id='buttonDiv'>
			<button class='stimuliButtons' id='positionButton' onclick='buttonPressed(0)'>Position (A)</button>
			<button class='stimuliButtons' id='shapeButton' onclick='buttonPressed(2)'>Shape (S)</button>
			<button class='stimuliButtons' id='colorButton' onclick='buttonPressed(1)'>Color (D)</button>
		</div>
	</div>
</body>

<script>
	var totalLevels = 10;
	var numOfSquares = 9;

	var unlockedLevel = 3; //Get from database after
	var level = 1; //Get level from user selection
	var mode = 1; //Modes: single, dual, triple, get from user selection

	//Move to css file after
	window.onload = function()
	{
		//Get original size of backgroundGrid.png
	    var gridImage = new Image();
	    gridImage.onload = function() 
	    {
	    	var grid = document.getElementById('grid');
			grid.style.width = gridImage.height;
			grid.style.height = gridImage.width;
	    }
	    gridImage.src = 'Images/backgroundGrid.png';

	    for(var i=0; i<numOfSquares; i++)
	    {
	    	var shapeImage = document.createElement("img");
	    	shapeImage.className = "shape";
	    	shapeImage.id = "shape"+i;
	    	shapeImage.src = 'Images/Grid/red_square.png';
	    	shapeImage.style.left = (i%3)*(1/3)*100+1.5+'%';
	    	shapeImage.style.top = Math.floor(i/3)*100*(1/3)+1.5+'%';
	    	document.getElementById('grid').appendChild(shapeImage);   
	    }

	    for(var i=1; i<=totalLevels; i++)
		{
			var levelRow = document.createElement("div");
			levelRow.className = "individualLevel";
			levelRow.id = "levelDiv"+i;

			if(i <= unlockedLevel)
			{
				levelRow.className += ' nonLockedLevels';
				levelRow.myLevel = i;
				levelRow.onclick = function(){
					levelSelected(this.myLevel);
				};
			}

			var levelRowLabel = document.createElement("label");
			levelRowLabel.className = "individualLabel";
			levelRowLabel.id = "levelLabel"+i;
			levelRowLabel.innerHTML = "Level "+i;

			if(i > unlockedLevel)
			{
				var levelBlurImage = document.createElement("img");
				levelBlurImage.id = "levelBlur"+i;
				levelBlurImage.className = "individualBlurLocked";
				levelBlurImage.src = "Images/blurredLock.png";
				levelRow.appendChild(levelBlurImage);
			}

			levelRow.appendChild(levelRowLabel);
			document.getElementById('selectLevelDiv').appendChild(levelRow);
		}

		levelSelected(unlockedLevel);

		document.getElementById('selectLevelDiv').style.display = "";
		document.getElementById('selectModeDiv').style.display = "";
		document.getElementById('startDiv').style.display = "";
	}

	function levelSelected(value)
	{
		level = value;

		var allUnlockedLevels = document.getElementsByClassName("nonLockedLevels");

		for(var s=0; s<allUnlockedLevels.length; s++)
		{
			allUnlockedLevels[s].style.backgroundColor = "white";
		}

		var levelSelect = document.getElementById('levelDiv'+value);
		levelSelect.style.backgroundColor = "green";
	}

	optionSelected(1); 
	function optionSelected(value)
	{
		mode = value;

		var allModes = document.getElementsByClassName("modeOptions");
		for(var s=0; s<allModes.length; s++)
		{
			allModes[s].style.backgroundColor = "white";
		}

		var modeSelected = document.getElementById('modeOption'+value);
		modeSelected.style.backgroundColor = "green";
	}

	function loadMainGame()
	{
		minTrial = level+1;
		maxTrial = 20+(mode*5)+level;

		if(mode == 1)
	    {
	    	document.getElementById("shapeButton").style.visibility = "hidden";
	    	document.getElementById("colorButton").style.visibility = "hidden";
	    	//Fix position of button
	    }
	    else if(mode == 2)
	    {
	    	document.getElementById("shapeButton").style.visibility = "hidden";
	    }

		window.scrollTo(0,0);

		document.getElementById('selectLevelDiv').style.display = "none";
		document.getElementById('selectModeDiv').style.display = "none";
		document.getElementById('startDiv').style.display = "none";
		document.getElementById('gameDiv').style.display = "";

		startGame();
	}

	//All other global variables required for the game
	var trialNumber = 0;
	var typeOfTrial;
	var targetTrials = [];
	var numTypeTrials = []; //1, 2, 1&2, 3, 1&3, 2&3, 1&2&3
	var minTrial, maxTrial;

	var positionValues = [];
	var colorValues = [];
	var shapeValues = [];

	var colorArray = ['red', 'blue', 'green', 'orange', 'purple', 'yellow', 'pink', 'turquoise', 'black'];
	var shapeArray = ['square', 'triangle', 'circle', 'diamond', 'heart', 'star', 'moon', 'cloud', 'checkmark'];

	var buttonShouldPressed = [false, false, false];
	var buttonValues = [false, false, false];

	var correct = 0;


	function startGame()
	{
		//Get target trials
		getTrials();

		var mainInterval = setInterval(function(){
			trialNumber++;
			clearToDefault();
			
			getTypeOfTrial();
			/*document.write(trialNumber+')'+typeOfTrial+' maxTrial: '+maxTrial);
			document.write("<br>");*/
			
			displayTrial();
			setTimeout(clearGrid, 500);

			if(trialNumber > level)
				setTimeout(checkCorrect, 2500);

			if(trialNumber >= maxTrial)
			{
				clearInterval(mainInterval);
			}
		}, 2600);
	}

	function getTrials()
	{
		var targetTrial, found;
		var numOfTargetTrials = 0; 

		if(mode == 1)
		{
			numTypeTrials[0] = getRandomNumber(7, 12);
		}
		else if(mode == 2)
		{
			numTypeTrials[0] = getRandomNumber(3, 5);
			numTypeTrials[1] = getRandomNumber(3, 5);
			numTypeTrials[2] = getRandomNumber(2, 3);
		}
		else if(mode == 3)
		{
			numTypeTrials[0] = getRandomNumber(2, 3);
			numTypeTrials[1] = getRandomNumber(2, 3);
			numTypeTrials[2] = getRandomNumber(1, 2);
			numTypeTrials[3] = getRandomNumber(2, 3);
			numTypeTrials[4] = getRandomNumber(1, 2);
			numTypeTrials[5] = getRandomNumber(1, 2);
			numTypeTrials[6] = 1;
		}

		for(var i=0; i<numTypeTrials.length; i++)
		{
			numOfTargetTrials += numTypeTrials[i];
		}

		/*document.write('numOfTargetTrials: '+numOfTargetTrials);
		document.write("<br>");
		document.write('numTypeTrials: '+numTypeTrials);
		document.write("<br>");*/

		while(targetTrials.length < numOfTargetTrials)
		{
			targetTrial = getRandomNumber(minTrial, maxTrial);
			found = false;

			for(var i=0; i<targetTrials.length; i++)
			{
				if(targetTrials[i] == targetTrial)
				{
					found = true;
					break;
				}
			}

			if(!found)
				targetTrials[targetTrials.length] = targetTrial;
		}
		/*
		document.write('targetTrials: '+targetTrials)
		document.write("<br>");*/
	}

	function clearToDefault()
	{
		buttonValues = [false, false, false];
		buttonShouldPressed = [false, false, false];
	}

	function getTypeOfTrial()
	{
		typeOfTrial = 'none';

		for(var i=0; i<targetTrials.length; i++)
		{
			if(trialNumber == targetTrials[i])
			{
				if(i < numTypeTrials[0])
					typeOfTrial = 'position';
				else if(i < (numTypeTrials[0]+numTypeTrials[1]))
					typeOfTrial = 'color';
				else if(i < (numTypeTrials[0]+numTypeTrials[1]+numTypeTrials[2]))
					typeOfTrial = 'position&color';
				else if(i < (numTypeTrials[0]+numTypeTrials[1]+numTypeTrials[2]+numTypeTrials[3]))
					typeOfTrial = 'shape';
				else if(i < (numTypeTrials[0]+numTypeTrials[1]+numTypeTrials[2]+numTypeTrials[3]+numTypeTrials[4]))
					typeOfTrial = 'position&shape';
				else if(i < (numTypeTrials[0]+numTypeTrials[1]+numTypeTrials[2]+numTypeTrials[3]+numTypeTrials[4]+numTypeTrials[5]))
					typeOfTrial = 'color&shape';
				else
					typeOfTrial = 'position&color&shape';
			}
		}
	}

	function displayTrial()
	{
		

		//Check whether to get a random color or a fixed color
		if(typeOfTrial.indexOf("color") > -1)
		{
			//Fixed Color
			colorValues[trialNumber] = colorValues[trialNumber-level];
			buttonShouldPressed[1] = true; 
		}
		else
		{
			//Random and non-fixed Color
			colorValues[trialNumber] = getRandomNumber(0, 8);
			while(colorValues[trialNumber] == colorValues[trialNumber-level])
			{
				colorValues[trialNumber] = getRandomNumber(0, 8);
			}
		}

		//Check whether to get a random shape or a fixed shape
		if(typeOfTrial.indexOf("shape") > -1)
		{
			//Fixed Shape
			shapeValues[trialNumber] = shapeValues[trialNumber-level];
			buttonShouldPressed[2] = true; 
		}
		else
		{
			//Random and non-fixed shape
			shapeValues[trialNumber] = getRandomNumber(0, 8);
			while(shapeValues[trialNumber] == shapeValues[trialNumber-level])
			{
				shapeValues[trialNumber] = getRandomNumber(0, 8);
			}
		}

		//Check whether to get a random position or fixed position
		if(typeOfTrial.indexOf("position") > -1)
		{
			//Get a fixed position because its a target trial for position
			positionValues[trialNumber] = positionValues[trialNumber-level];
			buttonShouldPressed[0] = true; 
		}
		else
		{
			//Get a random position 
			positionValues[trialNumber] = getRandomNumber(0, 8);
			//Make sure it doesn't accidently end up being a target Trial
			while(positionValues[trialNumber] == positionValues[trialNumber-level])
			{
				positionValues[trialNumber] = getRandomNumber(0, 8);
			}
		}	
		//Display the fixed or random position
		var img = document.getElementById('shape'+positionValues[trialNumber]);

		if(mode == 2)
		{
			img.src = ('Images/Grid/'+colorArray[colorValues[trialNumber]]+'_square.png');
		}
		else if(mode == 3)
		{
			img.src = ('Images/Grid/'+colorArray[colorValues[trialNumber]]+'_'+shapeArray[shapeValues[trialNumber]]+'.png');
		}

		setTimeout(function(){img.style.visibility = 'visible';}, 50)
	}	

	function clearGrid()
	{
		for(var i=0; i<numOfSquares; i++)
		{
			var img = document.getElementById('shape'+i);
			img.style.visibility = 'hidden';
		}
	}

	function buttonPressed(number)
	{
		buttonValues[number] = true;
	}

	function checkCorrect()
	{
		var allCorrect = true;

		//Remove this part after
		document.getElementById('pressToStart').innerHTML = trialNumber+ ') buttonShouldPressed: '+buttonShouldPressed+' buttonValues: '+buttonValues;

		for(var i=0; i<buttonValues.length; i++)
		{
			if(buttonValues[i] != buttonShouldPressed[i])
				allCorrect = false;
		}

		if(allCorrect == true)
			correct += 1;

		if(trialNumber >= maxTrial)
			alert('Total Correct: '+correct);
	}

	function getRandomNumber(low, high)
	{
		return Math.floor((Math.random()*(high-low+1)))+low;
	}
</script>

</html>
